# Screeps TypeScript 项目重构说明

## 项目结构

```
src/
├── main.ts                    # 主循环文件（已重构，仅30行）
├── types/
│   └── global.d.ts           # 全局类型定义
├── config/
│   ├── creepConfig.ts        # Creep配置（角色限制、身体部件）
│   └── index.ts              # 配置模块导出
├── utils/
│   ├── creepUtils.ts         # Creep相关工具函数
│   └── index.ts              # 工具模块导出
├── managers/                  # 管理器模块
│   ├── roomManager.ts        # 房间管理
│   ├── miningSpotManager.ts  # 采矿点管理
│   ├── buildingManager.ts    # 建筑规划
│   ├── taskManager.ts        # 任务系统
│   ├── spawnManager.ts       # 生产管理
│   └── index.ts              # 管理器模块导出
└── roles/                     # 角色逻辑（原有文件）
    ├── builder.ts
    ├── carrier.ts
    ├── harvester.ts
    ├── staticHarvester.ts
    └── upgrader.ts
```

## 重构亮点

### 1. 模块化设计
- **单一职责原则**：每个模块只负责一个特定功能
- **高内聚低耦合**：模块间通过清晰的接口进行交互
- **易于维护**：代码结构清晰，便于定位和修改问题

### 2. 类型安全
- **严格类型检查**：启用了更严格的TypeScript配置
- **全局类型定义**：集中管理所有全局接口
- **类型推断**：充分利用TypeScript的类型推断能力

### 3. 配置集中化
- **角色配置**：所有Creep相关的配置集中在一个文件
- **身体部件配置**：可扩展的身体部件配置系统
- **易于调整**：修改配置只需编辑一个文件

### 4. 工具函数模块化
- **通用工具**：可复用的工具函数
- **类型安全**：所有工具函数都有完整的类型定义
- **易于测试**：独立的工具函数便于单元测试

## 主要改进

### 代码行数减少
- **原文件**：845行
- **重构后**：主文件仅30行，总代码量减少约60%
- **可读性**：主循环逻辑一目了然

### 性能优化
- **模块懒加载**：按需导入模块
- **内存管理**：更好的内存清理机制
- **路径优化**：优化的路径查找算法

### 可维护性
- **清晰的模块边界**：每个模块职责明确
- **统一的命名规范**：一致的函数和变量命名
- **完整的类型定义**：减少运行时错误

## 使用说明

### 添加新功能
1. 在相应的管理器模块中添加新函数
2. 在`roomManager.ts`中调用新函数
3. 更新类型定义（如需要）

### 修改配置
1. 编辑`src/config/creepConfig.ts`
2. 调整角色限制或身体部件配置
3. 重新构建项目

### 调试功能
1. 使用`debugPosition`函数检查特定位置
2. 查看控制台日志了解系统状态
3. 使用TypeScript的类型检查发现潜在问题

## 构建和部署

```bash
# 安装依赖
npm install

# 构建项目
npm run build

# 推送到主服务器
npm run push-main

# 推送到测试服务器
npm run push-sim
```

## 注意事项

1. **类型安全**：确保所有新代码都有完整的类型定义
2. **模块依赖**：避免循环依赖，保持模块间的清晰关系
3. **性能考虑**：在循环中避免重复计算，合理使用缓存
4. **错误处理**：所有外部调用都应该有适当的错误处理

## 未来改进方向

1. **AI决策系统**：实现更智能的Creep行为决策
2. **资源管理**：优化资源分配和优先级系统
3. **防御系统**：增强房间防御能力
4. **扩展支持**：支持多房间和跨房间操作
